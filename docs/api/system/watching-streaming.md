# Watching & Streaming APIs

**Version:** XyPriss v6.1.0+  
**Branch:** feature/advanced-watching

## Overview

This document describes the high-performance file watching and streaming capabilities of the XyPriss System API. These features are powered by the native Rust engine (`xsys`) for maximum efficiency and reliability.

## File Watching API

### `__sys__.$watch(path, options)`

**Alias:** `$w` (coming soon)

Monitors a file or directory for system-level events (Created, Modified, Deleted, Renamed).

**Parameters:**

-   `path` (string): Path to monitor.
-   `options` (object):
    -   `duration` (number): Watch duration in seconds (default: 60).

---

### `__sys__.$watchAndProcess(path, callback, options)`

**Alias:** `__sys__.$wap(path, callback, options)`

Convenience utility that monitors a path and executes a logic callback after the cycle.

**Example:**

```typescript
__sys__.$wap(
    ".",
    () => {
        console.log("Check complete.");
    },
    { duration: 10 }
);
```

---

### `__sys__.$watchContent(path, options)`

**Alias:** `__sys__.$wc(path, options)`

**NEW:** Deep-monitoring sub-system that watches the actual **content** of a file instead of just metadata.

**Parameters:**

-   `path` (string): Target file path.
-   `options` (object):
    -   `duration` (number): Watch duration in seconds.
    -   `diff` (boolean): If `true`, computes and displays granular additions/removals.

**Example:**

```typescript
// Watch a configuration for specific changes
__sys__.$wc("settings.json", { duration: 30, diff: true });
```

## File Streaming API

### `__sys__.$stream(path, options)`

Reads a file in chunks using buffered I/O. Use this for GB-scale files to avoid Node.js memory overflows.

**Parameters:**

-   `path` (string): Target file path.
-   `options` (object):
    -   `chunkSize` (number): Size of each buffer in bytes (default: 8192).
    -   `hex` (boolean): If true, returns hexadecimal representation.

---

## Implementation Background

The implementation bypasses Node.js `fs` constraints by calling the `xsys` Rust binary:

1. **Watch**: Uses the `notify` crate.
2. **Advanced Watcher**: Implemented in `advanced_watcher.rs` for content diffing.
3. **Stream**: Uses `std::io::BufReader` for optimized chunking.

---

_Generated by Nehonix System Intelligence (NSI)_

