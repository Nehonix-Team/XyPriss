# Watching & Streaming APIs

**Version:** XyPriss v6.0.0+  
**Branch:** feature/watch-stream-api

## Overview

This document describes the high-performance file watching and streaming capabilities of the XyPriss System API. These features are powered by the native Rust engine (`xsys`) for maximum efficiency and reliability.

## File Watching API

### `__sys__.$watch(path, options)`

Monitors a file or directory for changes in real-time. This method is synchronous and blocks the execution for the specified duration.

**Parameters:**

-   `path` (string): Path to file or directory to watch.
-   `options` (object):
    -   `duration` (number): Duration to watch in seconds (default: 60).

**Events Detected:**

-   Creation
-   Modification
-   Deletion
-   Renaming

**Example Usage:**

```typescript
// Watch a folder for 30 seconds
__sys__.$watch("./src", { duration: 30 });
```

---

### `__sys__.$watchAndProcess(path, callback, options)`

A convenience wrapper that watches a directory and executes a callback after the watch period.

**Parameters:**

-   `path` (string): Path to watch.
-   `callback` (function): Logic to execute after the watch cycle.
-   `options` (object): Same as `$watch`.

**Example Usage:**

```typescript
__sys__.$watchAndProcess(
    "./logs",
    () => {
        console.log("Activity period ended. Analyzing logs...");
        const stats = __sys__.$ls("./logs", { stats: true });
        console.log(stats);
    },
    { duration: 10 }
);
```

## File Streaming API

### `__sys__.$stream(path, options)`

Reads a file in chunks using buffered I/O. This is the preferred method for reading very large files (GBs) as it prevents memory overflow.

**Parameters:**

-   `path` (string): Target file path.
-   `options` (object):
    -   `chunkSize` (number): Size of each buffer in bytes (default: 8192).
    -   `hex` (boolean): If true, returns hexadecimal representation.

**Returns:**

-   `string`: The output of the streaming operation.

**Example Usage:**

```typescript
// Stream a large log file
const content = __sys__.$stream("app.log", { chunkSize: 16384 });
console.log(content);

// Stream binary data in hex format
const binaryHex = __sys__.$stream("firmware.bin", { hex: true });
```

## Implementation Background

The implementation bypasses Node.js `fs` constraints by calling the `xsys` Rust binary:

1. **Watch**: Uses the `notify` crate (Cross-platform).
2. **Stream**: Uses `std::io::BufReader` for optimized chunking.

---

_Generated by Nehonix System Intelligence (NSI)_

